<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <title>Тестовая среда — Review (Улучшенная версия)</title>
  <link rel="stylesheet" href="style.css" type="text/css">
  <!-- Опционально: <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"> -->
</head>
<body>
  <header>
    <h1>Тестовая среда — Review</h1>
    <p>Frontend → Nginx → API1 и API2 (с данными из Postgres и Redis)</p>
  </header>
  <main class="container">
    <hr/>
    <section class="api-section">
      <h2>API1: Items</h2>
      <button onclick="callApi('api1')">Загрузить Items из API1</button>
      <span class="loader" id="api1-loader">Загрузка...</span>
      <div class="result" id="api1-result"></div>
    </section>
    <section class="api-section">
      <h2>API2: Tasks</h2>
      <button onclick="callApi('api2')">Загрузить Tasks из API2</button>
      <span class="loader" id="api2-loader">Загрузка...</span>
      <div class="result" id="api2-result"></div>
    </section>
  </main>

<script>
function callApi(api) {
  const loader = document.getElementById(`${api}-loader`);
  const resultDiv = document.getElementById(`${api}-result`);
  
  loader.style.display = 'inline';
  resultDiv.innerHTML = ''; 
  
  const endpoint = api === 'api1' ? '/api1/items' : '/api2/tasks';
  
  fetch(endpoint)
    .then(response => {
      if (!response.ok) throw new Error('Ошибка сети');
      return response.json();
    })
    .then(data => {
      loader.style.display = 'none';
      if (data.length === 0) {
        resultDiv.innerHTML = '<p class="error">Нет данных.</p>';
        return;
      }
      
      let table = '<table><thead><tr>';
      Object.keys(data[0]).forEach(key => { table += `<th>${key}</th>`; });
      table += '</tr></thead><tbody>';
      
      data.forEach(item => {
        table += '<tr>';
        Object.values(item).forEach(value => { table += `<td>${value}</td>`; });
        table += '</tr>';
      });
      
      table += '</tbody></table>';
      resultDiv.innerHTML = table;
    })
    .catch(error => {
      loader.style.display = 'none';
      resultDiv.innerHTML = `<p class="error">Ошибка: ${error.message}</p>`;
    });
}
</script>
</body>
</html>